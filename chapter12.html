<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬åäºŒç« ï¼šç”Ÿäº§éƒ¨ç½²ä¸è¿ç»´ - åŒºå—é“¾ç¨³å®šå¸æ•™ç¨‹</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="navbar-brand">ç¨³å®šå¸æ•™ç¨‹</a>
            <button class="navbar-toggle" onclick="toggleMobileNav()">â˜°</button>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">é¦–é¡µ</a>
                </li>
                <li class="nav-item">
                    <a href="intro.html" class="nav-link">å¼•è¨€</a>
                </li>
                <li class="nav-item dropdown">
                    <a href="#" class="nav-link">ç« èŠ‚</a>
                    <div class="dropdown-menu">
                        <a href="chapter1.html" class="dropdown-item">ç¬¬1ç« ï¼šåŒºå—é“¾åŸºç¡€</a>
                        <a href="chapter2.html" class="dropdown-item">ç¬¬2ç« ï¼šç¨³å®šå¸åˆ†ç±»</a>
                        <a href="chapter3.html" class="dropdown-item">ç¬¬3ç« ï¼šERC-20æ ‡å‡†</a>
                        <a href="chapter4.html" class="dropdown-item">ç¬¬4ç« ï¼šæŠµæŠ¼å‹è®¾è®¡</a>
                        <a href="chapter5.html" class="dropdown-item">ç¬¬5ç« ï¼šæ•°å­¦æ¨¡å‹</a>
                        <a href="chapter6.html" class="dropdown-item">ç¬¬6ç« ï¼šAMMé›†æˆ</a>
                        <a href="chapter7.html" class="dropdown-item">ç¬¬7ç« ï¼šå€Ÿè´·åè®®</a>
                        <a href="chapter8.html" class="dropdown-item">ç¬¬8ç« ï¼šæ”¶ç›Šç­–ç•¥</a>
                        <a href="chapter9.html" class="dropdown-item">ç¬¬9ç« ï¼šæ™ºèƒ½åˆçº¦å®‰å…¨</a>
                        <a href="chapter10.html" class="dropdown-item">ç¬¬10ç« ï¼šç»æµæ”»å‡»</a>
                        <a href="chapter11.html" class="dropdown-item">ç¬¬11ç« ï¼šæœªæ¥æ–¹å‘</a>
                        <a href="chapter12.html" class="dropdown-item">ç¬¬12ç« ï¼šç”Ÿäº§éƒ¨ç½²</a>
                        <a href="chapter13.html" class="dropdown-item">ç¬¬13ç« ï¼šç”Ÿæ€é›†æˆ</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="#resources" class="nav-link">èµ„æº</a>
                </li>
            </ul>
        </div>
    </nav>
    
    <!-- å¤´éƒ¨ -->
    <header id="top">
        <div class="container">
            <h1>ç¬¬åäºŒç« ï¼šç”Ÿäº§éƒ¨ç½²ä¸è¿ç»´</h1>
        </div>
    </header>
    
    <!-- ä¸»è¦å†…å®¹ -->
    <div class="container">
        <div class="chapter">
<h2>ç¬¬åäºŒç« ï¼šç”Ÿäº§éƒ¨ç½²ä¸è¿ç»´</h2>
        
        <p>ç†è®ºå­¦ä¹ å’Œå¼€å‘æµ‹è¯•åªæ˜¯ç¨³å®šå¸é¡¹ç›®çš„å¼€å§‹ï¼ŒçœŸæ­£çš„æŒ‘æˆ˜åœ¨äºå¦‚ä½•å°†ç³»ç»Ÿå®‰å…¨ã€ç¨³å®šåœ°éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚æœ¬ç« å°†åˆ†äº«ç”Ÿäº§çº§ç¨³å®šå¸ç³»ç»Ÿçš„éƒ¨ç½²ç»éªŒï¼Œæ¶µç›–ä»åŸºç¡€è®¾æ–½é€‰æ‹©åˆ°ç›‘æ§å‘Šè­¦ä½“ç³»ï¼Œä»å‡çº§ç­–ç•¥åˆ°åº”æ€¥å“åº”é¢„æ¡ˆã€‚æˆ‘ä»¬è¿˜å°†æ¢è®¨ç›‘ç®¡åˆè§„çš„å®è·µè¦æ±‚ï¼Œä»¥åŠå¦‚ä½•å»ºç«‹å¥å…¨çš„è¿ç»´ä½“ç³»ã€‚é€šè¿‡å­¦ä¹ ä¸»æµç¨³å®šå¸é¡¹ç›®çš„æˆåŠŸç»éªŒå’Œå¤±è´¥æ•™è®­ï¼Œæ‚¨å°†æŒæ¡å°†ç¨³å®šå¸ä»æ¦‚å¿µå˜ä¸ºç°å®çš„å…³é”®æŠ€èƒ½ã€‚</p>
        
        <div class="intro-box">
            <strong>æœ¬ç« æ¦‚è§ˆï¼š</strong>
            <ul>
                <li>å¤šé“¾éƒ¨ç½²æ¶æ„ä¸åŸºç¡€è®¾æ–½é€‰æ‹©</li>
                <li>ç›‘æ§ç³»ç»Ÿä¸å¯è§‚æµ‹æ€§å»ºè®¾</li>
                <li>å‡çº§ç­–ç•¥ä¸ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ</li>
                <li>ç›‘ç®¡åˆè§„ä¸å®¡è®¡è¦æ±‚</li>
                <li>æ¡ˆä¾‹ç ”ç©¶ï¼šä¸»æµç¨³å®šå¸çš„éƒ¨ç½²ç»éªŒ</li>
            </ul>
        </div>

        <h3 id="deployment-architecture">12.1 éƒ¨ç½²æ¶æ„ä¸åŸºç¡€è®¾æ–½</h3>
        
        <div class="theory-section">
            <h4>12.1.1 å¤šé“¾éƒ¨ç½²ç­–ç•¥</h4>
            <p>ç°ä»£ç¨³å®šå¸é€šå¸¸éœ€è¦åœ¨å¤šæ¡åŒºå—é“¾ä¸Šéƒ¨ç½²ï¼Œä»¥æ»¡è¶³ä¸åŒç”¨æˆ·ç¾¤ä½“çš„éœ€æ±‚ï¼š</p>
            
            <h5>é“¾é€‰æ‹©æ ‡å‡†</h5>
            <ul>
                <li><strong>ä»¥å¤ªåŠä¸»ç½‘</strong>ï¼šæœ€é«˜çš„å®‰å…¨æ€§å’ŒæµåŠ¨æ€§ï¼Œä½†Gasè´¹ç”¨é«˜æ˜‚</li>
                <li><strong>Layer 2ï¼ˆArbitrum/Optimismï¼‰</strong>ï¼šä½æˆæœ¬ï¼Œç»§æ‰¿ä»¥å¤ªåŠå®‰å…¨æ€§</li>
                <li><strong>ä¾§é“¾ï¼ˆPolygon/BSCï¼‰</strong>ï¼šæä½æˆæœ¬ï¼Œä½†å®‰å…¨æ€§è¾ƒä½</li>
                <li><strong>åº”ç”¨é“¾ï¼ˆCosmos/Avalancheå­ç½‘ï¼‰</strong>ï¼šå¯å®šåˆ¶æ€§å¼ºï¼Œé€‚åˆç‰¹å®šåœºæ™¯</li>
            </ul>
            
            <div class="code-block">
                <div class="code-header" onclick="toggleCode(this)">å¤šé“¾éƒ¨ç½²é…ç½® <span class="toggle-icon">â–¼</span></div>
                <div class="code-content" style="display: none;">
                    <pre><code class="language-typescript">// å¤šé“¾éƒ¨ç½²é…ç½®ç®¡ç†
interface ChainConfig {
    chainId: number;
    name: string;
    rpcUrl: string;
    explorerUrl: string;
    contracts: {
        stablecoin: string;
        oracle: string;
        governance: string;
        bridge?: string;
    };
    gasConfig: {
        maxFeePerGas: bigint;
        maxPriorityFeePerGas: bigint;
        gasLimit: bigint;
    };
}

class MultiChainDeployment {
    private configs: Map<number, ChainConfig> = new Map();
    
    constructor() {
        // ä¸»ç½‘é…ç½®
        this.configs.set(1, {
            chainId: 1,
            name: 'Ethereum Mainnet',
            rpcUrl: process.env.ETH_RPC_URL!,
            explorerUrl: 'https://etherscan.io',
            contracts: {
                stablecoin: '0x...',
                oracle: '0x...',
                governance: '0x...'
            },
            gasConfig: {
                maxFeePerGas: 50n * 10n**9n, // 50 gwei
                maxPriorityFeePerGas: 2n * 10n**9n,
                gasLimit: 3000000n
            }
        });
        
        // Arbitrumé…ç½®
        this.configs.set(42161, {
            chainId: 42161,
            name: 'Arbitrum One',
            rpcUrl: process.env.ARB_RPC_URL!,
            explorerUrl: 'https://arbiscan.io',
            contracts: {
                stablecoin: '0x...',
                oracle: '0x...',
                governance: '0x...',
                bridge: '0x...' // L1-L2æ¡¥æ¥åˆçº¦
            },
            gasConfig: {
                maxFeePerGas: 1n * 10n**9n, // 1 gwei
                maxPriorityFeePerGas: 0n,
                gasLimit: 10000000n
            }
        });
    }
    
    async deployToChain(chainId: number, contracts: ContractSet) {
        const config = this.configs.get(chainId);
        if (!config) throw new Error(`Chain ${chainId} not configured`);
        
        const provider = new ethers.JsonRpcProvider(config.rpcUrl);
        const deployer = new ethers.Wallet(process.env.DEPLOYER_KEY!, provider);
        
        // éƒ¨ç½²å‰æ£€æŸ¥
        await this.preDeploymentChecks(chainId, deployer);
        
        // éƒ¨ç½²åˆçº¦
        const deployed = await this.deployContracts(contracts, deployer, config);
        
        // éªŒè¯éƒ¨ç½²
        await this.verifyDeployment(deployed, config);
        
        // æ›´æ–°é…ç½®
        await this.updateChainConfig(chainId, deployed);
        
        return deployed;
    }
    
    private async preDeploymentChecks(chainId: number, deployer: Wallet) {
        // æ£€æŸ¥éƒ¨ç½²è€…ä½™é¢
        const balance = await deployer.provider.getBalance(deployer.address);
        if (balance < ethers.parseEther("0.1")) {
            throw new Error("Insufficient balance for deployment");
        }
        
        // æ£€æŸ¥nonceé˜²æ­¢é‡å¤éƒ¨ç½²
        const nonce = await deployer.getNonce();
        console.log(`Deployer nonce on chain ${chainId}: ${nonce}`);
        
        // æ£€æŸ¥é“¾æ˜¯å¦æ­£å¸¸
        const block = await deployer.provider.getBlock('latest');
        if (!block || block.timestamp < Date.now() / 1000 - 300) {
            throw new Error("Chain appears to be stalled");
        }
    }
}</code></pre>
                </div>
            </div>
        </div>
        
        <div class="practice-section">
            <h4>12.1.2 é«˜å¯ç”¨æ¶æ„è®¾è®¡</h4>
            
            <h5>å†—ä½™èŠ‚ç‚¹é…ç½®</h5>
            <div class="code-block">
                <div class="code-header" onclick="toggleCode(this)">å¤šèŠ‚ç‚¹è´Ÿè½½å‡è¡¡ <span class="toggle-icon">â–¼</span></div>
                <div class="code-content" style="display: none;">
                    <pre><code class="language-typescript">// é«˜å¯ç”¨RPCèŠ‚ç‚¹ç®¡ç†
class HighAvailabilityProvider {
    private providers: ethers.JsonRpcProvider[] = [];
    private healthScores: Map<string, number> = new Map();
    private currentIndex: number = 0;
    
    constructor(rpcUrls: string[]) {
        // åˆå§‹åŒ–å¤šä¸ªRPCæä¾›è€…
        for (const url of rpcUrls) {
            this.providers.push(new ethers.JsonRpcProvider(url));
            this.healthScores.set(url, 100);
        }
        
        // å®šæœŸå¥åº·æ£€æŸ¥
        setInterval(() => this.healthCheck(), 30000);
    }
    
    async call(method: string, params: any[]): Promise<any> {
        const maxRetries = 3;
        let lastError: Error | null = null;
        
        for (let retry = 0; retry < maxRetries; retry++) {
            const provider = this.getHealthyProvider();
            
            try {
                const result = await provider.send(method, params);
                this.updateHealthScore(provider, true);
                return result;
            } catch (error) {
                lastError = error as Error;
                this.updateHealthScore(provider, false);
                
                // å¦‚æœæ˜¯å…³é”®é”™è¯¯ï¼Œç«‹å³åˆ‡æ¢èŠ‚ç‚¹
                if (this.isCriticalError(error)) {
                    this.markProviderUnhealthy(provider);
                }
            }
        }
        
        throw new Error(`All providers failed: ${lastError?.message}`);
    }
    
    private getHealthyProvider(): ethers.JsonRpcProvider {
        // åŸºäºå¥åº·åˆ†æ•°çš„åŠ æƒéšæœºé€‰æ‹©
        const healthyProviders = this.providers.filter(p => 
            this.healthScores.get(p.connection.url) > 30
        );
        
        if (healthyProviders.length === 0) {
            // æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸å¥åº·ï¼Œé‡ç½®åˆ†æ•°å¹¶é‡è¯•
            this.resetHealthScores();
            return this.providers[0];
        }
        
        // è½®è¯¢é€‰æ‹©
        this.currentIndex = (this.currentIndex + 1) % healthyProviders.length;
        return healthyProviders[this.currentIndex];
    }
    
    private async healthCheck() {
        for (const provider of this.providers) {
            try {
                const start = Date.now();
                const block = await provider.getBlock('latest');
                const latency = Date.now() - start;
                
                // åŸºäºå»¶è¿Ÿå’ŒåŒºå—æ—¶é—´æ›´æ–°å¥åº·åˆ†æ•°
                if (block && latency < 1000) {
                    this.healthScores.set(provider.connection.url, 
                        Math.min(100, this.healthScores.get(provider.connection.url)! + 10)
                    );
                } else {
                    this.healthScores.set(provider.connection.url,
                        Math.max(0, this.healthScores.get(provider.connection.url)! - 20)
                    );
                }
            } catch {
                this.healthScores.set(provider.connection.url, 0);
            }
        }
    }
}</code></pre>
                </div>
            </div>
            
            <h5>ç¾éš¾æ¢å¤æœºåˆ¶</h5>
            <div class="info-box">
                <p><strong>å…³é”®ç»„ä»¶å¤‡ä»½ç­–ç•¥ï¼š</strong></p>
                <ul>
                    <li><strong>ç§é’¥ç®¡ç†</strong>ï¼šä½¿ç”¨HSMï¼ˆç¡¬ä»¶å®‰å…¨æ¨¡å—ï¼‰+ å¤šé‡ç­¾å</li>
                    <li><strong>çŠ¶æ€å¤‡ä»½</strong>ï¼šå®šæœŸå¿«ç…§åˆçº¦çŠ¶æ€åˆ°IPFS/Arweave</li>
                    <li><strong>é…ç½®å¤‡ä»½</strong>ï¼šåŠ å¯†å­˜å‚¨åœ¨å¤šä¸ªäº‘æœåŠ¡å•†</li>
                    <li><strong>ç´§æ€¥æš‚åœ</strong>ï¼šå¤šåœ°ç†ä½ç½®çš„ç´§æ€¥å“åº”å›¢é˜Ÿ</li>
                </ul>
            </div>
        </div>
        
        <h4>12.1.3 åŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆIaCï¼‰</h4>
        
        <div class="code-block">
            <div class="code-header" onclick="toggleCode(this)">Terraforméƒ¨ç½²é…ç½® <span class="toggle-icon">â–¼</span></div>
            <div class="code-content" style="display: none;">
                <pre><code class="language-hcl"># ç¨³å®šå¸ç³»ç»ŸåŸºç¡€è®¾æ–½é…ç½®
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    kubernetes = {
      source  = "hashicorp/kubernetes"
      version = "~> 2.0"
    }
  }
}

# RPCèŠ‚ç‚¹é›†ç¾¤
module "rpc_cluster" {
  source = "./modules/rpc-cluster"
  
  cluster_name = "stablecoin-rpc-${var.environment}"
  instance_type = "m5.2xlarge"
  
  # å¤šå¯ç”¨åŒºéƒ¨ç½²
  availability_zones = ["us-east-1a", "us-east-1b", "us-east-1c"]
  
  # è‡ªåŠ¨æ‰©å±•é…ç½®
  min_size = 3
  max_size = 10
  desired_capacity = 5
  
  # èŠ‚ç‚¹é…ç½®
  node_config = {
    ethereum_version = "v1.13.0"
    sync_mode = "full"
    cache_size = 4096
    
    # ç›‘æ§é…ç½®
    metrics_enabled = true
    metrics_port = 6060
  }
}

# ç›‘æ§å’Œå‘Šè­¦
resource "aws_cloudwatch_dashboard" "stablecoin_monitoring" {
  dashboard_name = "stablecoin-${var.environment}"
  
  dashboard_body = jsonencode({
    widgets = [
      {
        type = "metric"
        properties = {
          metrics = [
            ["AWS/EC2", "CPUUtilization", { stat = "Average" }],
            ["Custom", "ChainHeight", { stat = "Maximum" }],
            ["Custom", "PendingTransactions", { stat = "Average" }],
            ["Custom", "GasPrice", { stat = "Average" }]
          ]
          period = 300
          stat = "Average"
          region = "us-east-1"
          title = "RPC Node Health"
        }
      }
    ]
  })
}

# è‡ªåŠ¨åŒ–å¤‡ä»½
resource "aws_backup_plan" "stablecoin_backup" {
  name = "stablecoin-backup-${var.environment}"
  
  rule {
    rule_name         = "daily_backup"
    target_vault_name = aws_backup_vault.main.name
    schedule          = "cron(0 5 ? * * *)"
    
    lifecycle {
      delete_after = 30
    }
  }
  
  # å…³é”®æ•°æ®æ ‡ç­¾
  selection {
    name = "stablecoin_critical_data"
    resources = ["arn:aws:tag:*:*:*"]
    
    condition {
      type = "STRINGEQUALS"
      key = "Backup"
      value = "critical"
    }
  }
}</code></pre>
            </div>
        </div>
        
        <h3 id="monitoring-observability">12.2 ç›‘æ§ä¸å¯è§‚æµ‹æ€§</h3>
        
        <div class="theory-section">
            <h4>12.2.1 å…¨æ–¹ä½ç›‘æ§ä½“ç³»</h4>
            
            <h5>å…³é”®æŒ‡æ ‡å®šä¹‰</h5>
            <div class="code-block">
                <div class="code-header" onclick="toggleCode(this)">ç›‘æ§æŒ‡æ ‡ä½“ç³» <span class="toggle-icon">â–¼</span></div>
                <div class="code-content" style="display: none;">
                    <pre><code class="language-typescript">// ç¨³å®šå¸ç³»ç»Ÿç›‘æ§æŒ‡æ ‡
interface StablecoinMetrics {
    // ä¸šåŠ¡æŒ‡æ ‡
    business: {
        totalSupply: bigint;
        circulatingSupply: bigint;
        reserveRatio: number;
        pegDeviation: number;
        dailyVolume: bigint;
        uniqueHolders: number;
        averageHoldingPeriod: number;
    };
    
    // æŠ€æœ¯æŒ‡æ ‡
    technical: {
        gasPrice: bigint;
        blockConfirmationTime: number;
        transactionThroughput: number;
        errorRate: number;
        apiLatency: number[];
        nodesSynced: number;
        mempoolSize: number;
    };
    
    // å®‰å…¨æŒ‡æ ‡
    security: {
        suspiciousTransactions: number;
        largeTransfers: Transfer[];
        contractPausedEvents: number;
        failedAuthentications: number;
        abnormalGasUsage: Transaction[];
    };
    
    // é‡‘èé£é™©æŒ‡æ ‡
    risk: {
        var95: number; // 95% Value at Risk
        liquidationRatio: number;
        concentrationRisk: number; // èµ«èŠ¬è¾¾å°”æŒ‡æ•°
        velocityOfMoney: number;
        correlationWithBTC: number;
    };
}

class MonitoringService {
    private metrics: StablecoinMetrics;
    private prometheus: PrometheusClient;
    private alertManager: AlertManager;
    
    constructor() {
        this.setupMetricsCollection();
        this.configureAlerts();
    }
    
    private setupMetricsCollection() {
        // PrometheusæŒ‡æ ‡æ³¨å†Œ
        const totalSupplyGauge = new Gauge({
            name: 'stablecoin_total_supply',
            help: 'Total supply of stablecoin',
            labelNames: ['chain', 'token']
        });
        
        const pegDeviationGauge = new Gauge({
            name: 'stablecoin_peg_deviation',
            help: 'Deviation from $1 peg in percentage',
            labelNames: ['chain', 'token', 'exchange']
        });
        
        const gasUsageHistogram = new Histogram({
            name: 'stablecoin_gas_usage',
            help: 'Gas usage distribution for stablecoin transactions',
            labelNames: ['chain', 'function'],
            buckets: [21000, 50000, 100000, 200000, 500000]
        });
        
        // å®æ—¶æ•°æ®æ”¶é›†
        setInterval(async () => {
            await this.collectBusinessMetrics();
            await this.collectTechnicalMetrics();
            await this.collectSecurityMetrics();
            await this.collectRiskMetrics();
        }, 60000); // æ¯åˆ†é’Ÿæ›´æ–°
    }
    
    private async collectBusinessMetrics() {
        // ä»é“¾ä¸Šæ”¶é›†ä¾›åº”é‡æ•°æ®
        const totalSupply = await this.contract.totalSupply();
        const circulatingSupply = await this.calculateCirculatingSupply();
        
        this.metrics.business.totalSupply = totalSupply;
        this.metrics.business.circulatingSupply = circulatingSupply;
        
        // è®¡ç®—å‚¨å¤‡ç‡
        const reserves = await this.getReserveValue();
        this.metrics.business.reserveRatio = Number(reserves * 100n / totalSupply) / 100;
        
        // æ£€æµ‹ä»·æ ¼åç¦»
        const pegDeviation = await this.calculatePegDeviation();
        this.metrics.business.pegDeviation = pegDeviation;
        
        // è§¦å‘å‘Šè­¦
        if (Math.abs(pegDeviation) > 0.03) { // 3%åç¦»
            await this.alertManager.sendAlert({
                severity: 'critical',
                message: `Peg deviation detected: ${pegDeviation * 100}%`,
                labels: {
                    chain: this.chainName,
                    token: this.tokenSymbol
                }
            });
        }
    }
}</code></pre>
                </div>
            </div>
        </div>
        
        <div class="practice-section">
            <h4>12.2.2 å®æ—¶å‘Šè­¦ç³»ç»Ÿ</h4>
            
            <div class="code-block">
                <div class="code-header" onclick="toggleCode(this)">æ™ºèƒ½å‘Šè­¦è§„åˆ™å¼•æ“ <span class="toggle-icon">â–¼</span></div>
                <div class="code-content" style="display: none;">
                    <pre><code class="language-typescript">// å‘Šè­¦è§„åˆ™å¼•æ“
class AlertingEngine {
    private rules: AlertRule[] = [];
    private notifications: NotificationChannel[] = [];
    
    constructor() {
        this.initializeRules();
        this.setupNotificationChannels();
    }
    
    private initializeRules() {
        // ä»·æ ¼ç¨³å®šæ€§å‘Šè­¦
        this.addRule({
            name: 'peg_deviation_critical',
            condition: (metrics: StablecoinMetrics) => 
                Math.abs(metrics.business.pegDeviation) > 0.05,
            severity: 'critical',
            cooldown: 300, // 5åˆ†é’Ÿå†·å´æœŸ
            actions: ['pagerduty', 'telegram', 'email'],
            message: (metrics) => 
                `CRITICAL: Stablecoin peg deviation ${metrics.business.pegDeviation * 100}%`
        });
        
        // å‚¨å¤‡ç‡å‘Šè­¦
        this.addRule({
            name: 'reserve_ratio_low',
            condition: (metrics) => metrics.business.reserveRatio < 1.05,
            severity: 'high',
            cooldown: 600,
            actions: ['telegram', 'email'],
            message: (metrics) => 
                `WARNING: Reserve ratio below safety threshold: ${metrics.business.reserveRatio}`
        });
        
        // å¼‚å¸¸äº¤æ˜“æ¨¡å¼
        this.addRule({
            name: 'suspicious_activity',
            condition: (metrics) => {
                const recent = metrics.security.suspiciousTransactions;
                return recent > 10; // æœ€è¿‘1å°æ—¶è¶…è¿‡10ç¬”å¯ç–‘äº¤æ˜“
            },
            severity: 'medium',
            cooldown: 1800,
            actions: ['security_team'],
            message: (metrics) => 
                `Suspicious activity detected: ${metrics.security.suspiciousTransactions} transactions`
        });
        
        // Gasä»·æ ¼å¼‚å¸¸
        this.addRule({
            name: 'gas_spike',
            condition: (metrics) => 
                metrics.technical.gasPrice > 500n * 10n**9n, // 500 gwei
            severity: 'medium',
            cooldown: 300,
            actions: ['ops_team'],
            message: (metrics) => 
                `High gas prices detected: ${ethers.formatUnits(metrics.technical.gasPrice, 'gwei')} gwei`
        });
    }
    
    async evaluateRules(metrics: StablecoinMetrics) {
        for (const rule of this.rules) {
            if (rule.condition(metrics)) {
                // æ£€æŸ¥å†·å´æœŸ
                if (!this.isInCooldown(rule)) {
                    await this.triggerAlert(rule, metrics);
                }
            }
        }
    }
    
    private async triggerAlert(rule: AlertRule, metrics: StablecoinMetrics) {
        const alert = {
            rule: rule.name,
            severity: rule.severity,
            message: rule.message(metrics),
            timestamp: new Date(),
            metrics: this.extractRelevantMetrics(rule, metrics)
        };
        
        // å‘é€åˆ°é…ç½®çš„é€šçŸ¥æ¸ é“
        for (const action of rule.actions) {
            const channel = this.notifications.find(n => n.name === action);
            if (channel) {
                await channel.send(alert);
            }
        }
        
        // è®°å½•å‘Šè­¦å†å²
        await this.logAlert(alert);
        
        // è®¾ç½®å†·å´æœŸ
        this.setCooldown(rule);
    }
}</code></pre>
                </div>
            </div>
            
            <h5>å¯è§†åŒ–ä»ªè¡¨æ¿</h5>
            <div class="info-box">
                <p><strong>Grafanaä»ªè¡¨æ¿é…ç½®ç¤ºä¾‹ï¼š</strong></p>
                <div class="code-block">
                    <div class="code-header" onclick="toggleCode(this)">Grafana Dashboard JSON <span class="toggle-icon">â–¼</span></div>
                    <div class="code-content" style="display: none;">
                        <pre><code class="language-json">{
  "dashboard": {
    "title": "Stablecoin Production Monitoring",
    "panels": [
      {
        "title": "Price Stability",
        "targets": [
          {
            "expr": "stablecoin_price{exchange=\"uniswap\"}",
            "legendFormat": "Uniswap"
          },
          {
            "expr": "stablecoin_price{exchange=\"curve\"}",
            "legendFormat": "Curve"
          }
        ],
        "alert": {
          "conditions": [
            {
              "evaluator": {
                "params": [0.97, 1.03],
                "type": "outside_range"
              }
            }
          ]
        }
      },
      {
        "title": "Supply Metrics",
        "targets": [
          {
            "expr": "stablecoin_total_supply",
            "legendFormat": "Total Supply"
          },
          {
            "expr": "stablecoin_circulating_supply",
            "legendFormat": "Circulating"
          }
        ]
      },
      {
        "title": "Transaction Volume",
        "targets": [
          {
            "expr": "rate(stablecoin_transfer_volume[5m])",
            "legendFormat": "5min avg"
          }
        ]
      }
    ]
  }
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
        
        <h3 id="upgrade-strategies">12.3 å‡çº§ç­–ç•¥ä¸ç‰ˆæœ¬ç®¡ç†</h3>
        
        <div class="theory-section">
            <h4>12.3.1 é›¶åœæœºå‡çº§æ–¹æ¡ˆ</h4>
            
            <div class="code-block">
                <div class="code-header" onclick="toggleCode(this)">å‡çº§æ§åˆ¶å™¨å®ç° <span class="toggle-icon">â–¼</span></div>
                <div class="code-content" style="display: none;">
                    <pre><code class="language-solidity">// é«˜çº§å‡çº§æ§åˆ¶å™¨
contract UpgradeController is AccessControl {
    using SafeMath for uint256;
    
    // è§’è‰²å®šä¹‰
    bytes32 public constant UPGRADER_ROLE = keccak256("UPGRADER_ROLE");
    bytes32 public constant GUARDIAN_ROLE = keccak256("GUARDIAN_ROLE");
    
    // å‡çº§é˜¶æ®µ
    enum UpgradePhase {
        None,
        Proposed,
        Testing,
        Staged,
        Executing,
        Completed,
        Cancelled
    }
    
    struct UpgradeProposal {
        address newImplementation;
        bytes initData;
        uint256 proposedAt;
        uint256 testingDeadline;
        uint256 executionDeadline;
        UpgradePhase phase;
        mapping(address => bool) approvals;
        uint256 approvalCount;
        bytes32 codeHash; // æ–°å®ç°çš„ä»£ç å“ˆå¸Œ
    }
    
    mapping(uint256 => UpgradeProposal) public proposals;
    uint256 public proposalCount;
    
    // é…ç½®å‚æ•°
    uint256 public constant MIN_TESTING_PERIOD = 3 days;
    uint256 public constant MIN_STAGING_PERIOD = 2 days;
    uint256 public constant APPROVAL_THRESHOLD = 3;
    
    // æµ‹è¯•ç¯å¢ƒ
    address public testEnvironment;
    
    event UpgradeProposed(uint256 indexed proposalId, address implementation);
    event UpgradeTested(uint256 indexed proposalId, bool success);
    event UpgradeStaged(uint256 indexed proposalId);
    event UpgradeExecuted(uint256 indexed proposalId);
    
    function proposeUpgrade(
        address newImplementation,
        bytes calldata initData
    ) external onlyRole(UPGRADER_ROLE) returns (uint256) {
        require(newImplementation != address(0), "Invalid implementation");
        
        // éªŒè¯æ–°å®ç°çš„ä»£ç 
        bytes32 codeHash = keccak256(newImplementation.code);
        require(isValidImplementation(newImplementation), "Invalid implementation");
        
        uint256 proposalId = proposalCount++;
        UpgradeProposal storage proposal = proposals[proposalId];
        
        proposal.newImplementation = newImplementation;
        proposal.initData = initData;
        proposal.proposedAt = block.timestamp;
        proposal.testingDeadline = block.timestamp + MIN_TESTING_PERIOD;
        proposal.phase = UpgradePhase.Proposed;
        proposal.codeHash = codeHash;
        
        emit UpgradeProposed(proposalId, newImplementation);
        return proposalId;
    }
    
    function runTestSuite(uint256 proposalId) external {
        UpgradeProposal storage proposal = proposals[proposalId];
        require(proposal.phase == UpgradePhase.Proposed, "Invalid phase");
        
        // éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
        address testProxy = deployTestProxy(
            proposal.newImplementation,
            proposal.initData
        );
        
        // è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
        bool testsPassed = ITestSuite(testEnvironment).runTests(testProxy);
        
        if (testsPassed) {
            proposal.phase = UpgradePhase.Testing;
            emit UpgradeTested(proposalId, true);
        } else {
            proposal.phase = UpgradePhase.Cancelled;
            emit UpgradeTested(proposalId, false);
        }
    }
    
    function approveForStaging(uint256 proposalId) 
        external 
        onlyRole(GUARDIAN_ROLE) 
    {
        UpgradeProposal storage proposal = proposals[proposalId];
        require(proposal.phase == UpgradePhase.Testing, "Not in testing");
        require(block.timestamp >= proposal.testingDeadline, "Testing period not over");
        require(!proposal.approvals[msg.sender], "Already approved");
        
        proposal.approvals[msg.sender] = true;
        proposal.approvalCount++;
        
        if (proposal.approvalCount >= APPROVAL_THRESHOLD) {
            proposal.phase = UpgradePhase.Staged;
            proposal.executionDeadline = block.timestamp + MIN_STAGING_PERIOD;
            emit UpgradeStaged(proposalId);
        }
    }
    
    function executeUpgrade(uint256 proposalId) external onlyRole(UPGRADER_ROLE) {
        UpgradeProposal storage proposal = proposals[proposalId];
        require(proposal.phase == UpgradePhase.Staged, "Not staged");
        require(block.timestamp >= proposal.executionDeadline, "Staging period not over");
        
        proposal.phase = UpgradePhase.Executing;
        
        // æ‰§è¡Œå‡çº§ï¼ˆç¤ºä¾‹ä½¿ç”¨é€æ˜ä»£ç†æ¨¡å¼ï¼‰
        ITransparentUpgradeableProxy(getProxyAddress()).upgradeToAndCall(
            proposal.newImplementation,
            proposal.initData
        );
        
        proposal.phase = UpgradePhase.Completed;
        emit UpgradeExecuted(proposalId);
    }
    
    // ç´§æ€¥å›æ»šæœºåˆ¶
    function emergencyRollback(address previousImplementation) 
        external 
        onlyRole(GUARDIAN_ROLE) 
    {
        // éœ€è¦å¤šé‡ç­¾åçš„ç´§æ€¥å›æ»š
        // å®ç°çœç•¥
    }
}</code></pre>
                </div>
            </div>
        </div>
        
        <div class="practice-section">
            <h4>12.3.2 æ•°æ®è¿ç§»ç­–ç•¥</h4>
            
            <div class="code-block">
                <div class="code-header" onclick="toggleCode(this)">å­˜å‚¨å¸ƒå±€è¿ç§» <span class="toggle-icon">â–¼</span></div>
                <div class="code-content" style="display: none;">
                    <pre><code class="language-solidity">// æ•°æ®è¿ç§»åˆçº¦
contract DataMigration {
    // æ—§ç‰ˆæœ¬å­˜å‚¨å¸ƒå±€
    struct OldUserData {
        uint256 balance;
        uint256 lastUpdate;
        bool isActive;
    }
    
    // æ–°ç‰ˆæœ¬å­˜å‚¨å¸ƒå±€
    struct NewUserData {
        uint256 balance;
        uint256 lastUpdate;
        bool isActive;
        uint256 tier;           // æ–°å¢å­—æ®µ
        uint256 rewardsEarned;  // æ–°å¢å­—æ®µ
        address referrer;       // æ–°å¢å­—æ®µ
    }
    
    // æ‰¹é‡è¿ç§»é…ç½®
    uint256 public constant BATCH_SIZE = 100;
    uint256 public migrationProgress;
    bool public migrationComplete;
    
    mapping(address => OldUserData) private oldStorage;
    mapping(address => NewUserData) public newStorage;
    address[] public userAddresses;
    
    event MigrationBatch(uint256 startIndex, uint256 endIndex);
    event MigrationCompleted(uint256 totalUsers);
    
    function migrateBatch() external {
        require(!migrationComplete, "Migration already complete");
        
        uint256 startIndex = migrationProgress;
        uint256 endIndex = Math.min(
            startIndex + BATCH_SIZE,
            userAddresses.length
        );
        
        for (uint256 i = startIndex; i < endIndex; i++) {
            address user = userAddresses[i];
            OldUserData memory oldData = oldStorage[user];
            
            // è¿ç§»æ•°æ®å¹¶è®¾ç½®é»˜è®¤å€¼
            newStorage[user] = NewUserData({
                balance: oldData.balance,
                lastUpdate: oldData.lastUpdate,
                isActive: oldData.isActive,
                tier: calculateInitialTier(oldData.balance),
                rewardsEarned: 0,
                referrer: address(0)
            });
            
            // æ¸…ç†æ—§æ•°æ®ä»¥èŠ‚çœgas
            delete oldStorage[user];
        }
        
        migrationProgress = endIndex;
        emit MigrationBatch(startIndex, endIndex);
        
        if (migrationProgress >= userAddresses.length) {
            migrationComplete = true;
            emit MigrationCompleted(userAddresses.length);
        }
    }
    
    function calculateInitialTier(uint256 balance) private pure returns (uint256) {
        if (balance >= 1000000 * 10**18) return 3; // é²¸é±¼
        if (balance >= 10000 * 10**18) return 2;   // å¤§æˆ·
        if (balance >= 100 * 10**18) return 1;     // æ´»è·ƒç”¨æˆ·
        return 0; // æ™®é€šç”¨æˆ·
    }
    
    // æ•°æ®éªŒè¯
    function verifyMigration(address[] calldata users) external view returns (bool) {
        for (uint256 i = 0; i < users.length; i++) {
            address user = users[i];
            OldUserData memory oldData = getOldData(user);
            NewUserData memory newData = newStorage[user];
            
            // éªŒè¯å…³é”®æ•°æ®å®Œæ•´æ€§
            if (oldData.balance != newData.balance ||
                oldData.lastUpdate != newData.lastUpdate ||
                oldData.isActive != newData.isActive) {
                return false;
            }
        }
        return true;
    }
}</code></pre>
                </div>
            </div>
        </div>
        
        <h3 id="regulatory-compliance">12.4 ç›‘ç®¡åˆè§„ä¸å®¡è®¡</h3>
        
        <div class="theory-section">
            <h4>12.4.1 åˆè§„æ¡†æ¶å®æ–½</h4>
            
            <div class="code-block">
                <div class="code-header" onclick="toggleCode(this)">KYC/AMLé›†æˆç³»ç»Ÿ <span class="toggle-icon">â–¼</span></div>
                <div class="code-content" style="display: none;">
                    <pre><code class="language-solidity">// åˆè§„ç®¡ç†åˆçº¦
contract ComplianceManager is AccessControl, Pausable {
    // åˆè§„ç­‰çº§
    enum ComplianceLevel {
        None,
        Basic,      // åŸºç¡€KYC
        Enhanced,   // å¢å¼ºKYC
        Institutional // æœºæ„çº§åˆ«
    }
    
    // å¸æ³•ç®¡è¾–åŒº
    enum Jurisdiction {
        US,
        EU,
        UK,
        APAC,
        Other
    }
    
    struct UserCompliance {
        ComplianceLevel level;
        Jurisdiction jurisdiction;
        uint256 kycExpiry;
        uint256 dailyLimit;
        uint256 monthlyLimit;
        uint256 dailyVolume;
        uint256 monthlyVolume;
        uint256 lastResetDaily;
        uint256 lastResetMonthly;
        bool sanctioned;
        string kycProvider; // Chainalysis, Ellipticç­‰
    }
    
    mapping(address => UserCompliance) public userCompliance;
    mapping(Jurisdiction => uint256) public jurisdictionLimits;
    
    // åˆè§„æä¾›å•†æ¥å£
    mapping(string => address) public complianceProviders;
    
    // åˆ¶è£åå•
    mapping(address => bool) public sanctionsList;
    
    // å¯ç–‘æ´»åŠ¨æŠ¥å‘Š
    struct SAR {
        address user;
        string reason;
        uint256 amount;
        uint256 timestamp;
        bool resolved;
    }
    SAR[] public suspiciousReports;
    
    event ComplianceUpdated(address indexed user, ComplianceLevel level);
    event SuspiciousActivity(address indexed user, string reason);
    event LimitExceeded(address indexed user, uint256 amount);
    
    function updateUserCompliance(
        address user,
        ComplianceLevel level,
        Jurisdiction jurisdiction,
        uint256 kycExpiry
    ) external onlyRole(COMPLIANCE_ROLE) {
        require(!sanctionsList[user], "User is sanctioned");
        
        UserCompliance storage compliance = userCompliance[user];
        compliance.level = level;
        compliance.jurisdiction = jurisdiction;
        compliance.kycExpiry = kycExpiry;
        
        // æ ¹æ®åˆè§„ç­‰çº§è®¾ç½®é™é¢
        if (level == ComplianceLevel.Basic) {
            compliance.dailyLimit = 10000 * 10**18;   // $10k
            compliance.monthlyLimit = 100000 * 10**18; // $100k
        } else if (level == ComplianceLevel.Enhanced) {
            compliance.dailyLimit = 100000 * 10**18;   // $100k
            compliance.monthlyLimit = 1000000 * 10**18; // $1M
        } else if (level == ComplianceLevel.Institutional) {
            compliance.dailyLimit = type(uint256).max;
            compliance.monthlyLimit = type(uint256).max;
        }
        
        emit ComplianceUpdated(user, level);
    }
    
    function checkTransactionCompliance(
        address from,
        address to,
        uint256 amount
    ) external returns (bool) {
        // æ£€æŸ¥åˆ¶è£åå•
        if (sanctionsList[from] || sanctionsList[to]) {
            emit SuspiciousActivity(from, "Sanctioned address");
            return false;
        }
        
        UserCompliance storage fromCompliance = userCompliance[from];
        UserCompliance storage toCompliance = userCompliance[to];
        
        // æ£€æŸ¥KYCæœ‰æ•ˆæœŸ
        if (block.timestamp > fromCompliance.kycExpiry) {
            return false;
        }
        
        // æ›´æ–°å’Œæ£€æŸ¥é™é¢
        updateVolumeLimits(fromCompliance);
        
        if (fromCompliance.dailyVolume + amount > fromCompliance.dailyLimit) {
            emit LimitExceeded(from, amount);
            return false;
        }
        
        // å¸æ³•ç®¡è¾–åŒºæ£€æŸ¥
        if (!isTransferAllowed(fromCompliance.jurisdiction, toCompliance.jurisdiction)) {
            return false;
        }
        
        // æ›´æ–°äº¤æ˜“é‡
        fromCompliance.dailyVolume += amount;
        fromCompliance.monthlyVolume += amount;
        
        // å¯ç–‘æ´»åŠ¨æ£€æµ‹
        if (isActivitySuspicious(from, to, amount)) {
            reportSuspiciousActivity(from, to, amount);
        }
        
        return true;
    }
    
    function isActivitySuspicious(
        address from,
        address to,
        uint256 amount
    ) private view returns (bool) {
        // å¿«é€Ÿè¿ç»­å¤§é¢è½¬è´¦
        // ç»“æ„åŒ–äº¤æ˜“ï¼ˆæ‹†åˆ†ä»¥è§„é¿é™é¢ï¼‰
        // å¼‚å¸¸æ—¶é—´æ¨¡å¼
        // é«˜é£é™©åœ°å€äº¤äº’
        
        // ç®€åŒ–ç¤ºä¾‹
        return amount > 50000 * 10**18 && 
               userCompliance[from].level == ComplianceLevel.Basic;
    }
}</code></pre>
                </div>
            </div>
        </div>
        
        <div class="practice-section">
            <h4>12.4.2 å®¡è®¡æ—¥å¿—ä¸æŠ¥å‘Š</h4>
            
            <div class="code-block">
                <div class="code-header" onclick="toggleCode(this)">å®¡è®¡è·Ÿè¸ªç³»ç»Ÿ <span class="toggle-icon">â–¼</span></div>
                <div class="code-content" style="display: none;">
                    <pre><code class="language-typescript">// å®¡è®¡æ—¥å¿—æœåŠ¡
class AuditLogger {
    private storage: AuditStorage;
    private encryption: EncryptionService;
    
    constructor() {
        this.storage = new AuditStorage();
        this.encryption = new EncryptionService();
    }
    
    async logTransaction(tx: Transaction) {
        const auditEntry: AuditEntry = {
            id: generateAuditId(),
            timestamp: Date.now(),
            type: 'TRANSACTION',
            actor: tx.from,
            action: tx.function,
            target: tx.to,
            value: tx.value,
            data: {
                txHash: tx.hash,
                blockNumber: tx.blockNumber,
                gasUsed: tx.gasUsed,
                status: tx.status
            },
            metadata: {
                ip: await this.getActorIP(tx.from),
                userAgent: await this.getUserAgent(tx.from),
                complianceLevel: await this.getComplianceLevel(tx.from)
            }
        };
        
        // åŠ å¯†æ•æ„Ÿæ•°æ®
        const encryptedEntry = await this.encryption.encrypt(auditEntry);
        
        // å­˜å‚¨åˆ°ä¸å¯å˜å­˜å‚¨
        await this.storage.store(encryptedEntry);
        
        // å®æ—¶åˆè§„æ£€æŸ¥
        await this.checkCompliance(auditEntry);
    }
    
    async generateComplianceReport(
        startDate: Date,
        endDate: Date,
        jurisdiction: string
    ): Promise<ComplianceReport> {
        const entries = await this.storage.query({
            startDate,
            endDate,
            filters: { jurisdiction }
        });
        
        const report: ComplianceReport = {
            period: { start: startDate, end: endDate },
            jurisdiction,
            summary: {
                totalTransactions: entries.length,
                totalVolume: this.calculateVolume(entries),
                uniqueUsers: this.countUniqueUsers(entries),
                suspiciousActivities: this.filterSuspicious(entries).length
            },
            userMetrics: await this.aggregateUserMetrics(entries),
            riskIndicators: await this.calculateRiskIndicators(entries),
            regulatoryMetrics: this.getJurisdictionMetrics(entries, jurisdiction)
        };
        
        // ç”ŸæˆPDFæŠ¥å‘Š
        const pdf = await this.generatePDF(report);
        
        // æ•°å­—ç­¾å
        const signedReport = await this.signReport(pdf);
        
        return signedReport;
    }
    
    private async checkCompliance(entry: AuditEntry) {
        // å®æ—¶åˆè§„è§„åˆ™å¼•æ“
        const rules = await this.loadComplianceRules(entry.metadata.jurisdiction);
        
        for (const rule of rules) {
            if (rule.evaluate(entry)) {
                await this.handleComplianceViolation(entry, rule);
            }
        }
    }
}</code></pre>
                </div>
            </div>
        </div>
        
        <h3 id="case-studies">12.5 æ¡ˆä¾‹ç ”ç©¶ä¸æœ€ä½³å®è·µ</h3>
        
        <div class="theory-section">
            <h4>12.5.1 ä¸»æµç¨³å®šå¸éƒ¨ç½²æ¡ˆä¾‹åˆ†æ</h4>
            
            <h5>USDCéƒ¨ç½²æ¶æ„</h5>
            <div class="info-box">
                <p><strong>Circleçš„USDCç”Ÿäº§éƒ¨ç½²ç‰¹ç‚¹ï¼š</strong></p>
                <ul>
                    <li><strong>å¤šç­¾æ²»ç†</strong>ï¼š3/5å¤šç­¾ç”¨äºå…³é”®æ“ä½œ</li>
                    <li><strong>è·¨é“¾æ¶æ„</strong>ï¼šåŸç”Ÿéƒ¨ç½²åœ¨8+æ¡é“¾</li>
                    <li><strong>å‚¨å¤‡è¯æ˜</strong>ï¼šæ¯æœˆç¬¬ä¸‰æ–¹å®¡è®¡æŠ¥å‘Š</li>
                    <li><strong>åˆè§„é›†æˆ</strong>ï¼šå®æ—¶KYC/AMLæ£€æŸ¥</li>
                    <li><strong>ç¾éš¾æ¢å¤</strong>ï¼š24å°æ—¶å†…å¯æ¢å¤æœåŠ¡</li>
                </ul>
            </div>
            
            <h5>MakerDAOè¿ç»´å®è·µ</h5>
            <div class="warning-box">
                <p><strong>MakerDAOçš„å…³é”®è¿ç»´ç»éªŒï¼š</strong></p>
                <ul>
                    <li><strong>Keeperç½‘ç»œ</strong>ï¼šå»ä¸­å¿ƒåŒ–çš„æ¸…ç®—æ‰§è¡Œè€…</li>
                    <li><strong>é¢„è¨€æœºå»¶è¿Ÿ</strong>ï¼š1å°æ—¶ä»·æ ¼å»¶è¿Ÿé˜²æ­¢é—ªç”µè´·æ”»å‡»</li>
                    <li><strong>ç´§æ€¥å…³åœ</strong>ï¼šå…¨å±€æš‚åœæœºåˆ¶ï¼Œéœ€è¦5ä¸‡MKRæ¿€æ´»</li>
                    <li><strong>æ¨¡å—åŒ–å‡çº§</strong>ï¼šæ ¸å¿ƒæ¨¡å—ç‹¬ç«‹å‡çº§</li>
                    <li><strong>é£é™©å‚æ•°</strong>ï¼šé€šè¿‡æ²»ç†åŠ¨æ€è°ƒæ•´</li>
                </ul>
            </div>
        </div>
        
        <div class="practice-section">
            <h4>12.5.2 ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•</h4>
            
            <div class="code-block">
                <div class="code-header" onclick="toggleCode(this)">éƒ¨ç½²å‰æ£€æŸ¥è„šæœ¬ <span class="toggle-icon">â–¼</span></div>
                <div class="code-content" style="display: none;">
                    <pre><code class="language-typescript">// ç”Ÿäº§éƒ¨ç½²æ£€æŸ¥æ¸…å•
class ProductionReadinessChecker {
    private checks: Check[] = [];
    
    constructor() {
        this.initializeChecks();
    }
    
    private initializeChecks() {
        // åˆçº¦å®‰å…¨æ£€æŸ¥
        this.addCheck({
            name: 'Contract Security Audit',
            category: 'Security',
            severity: 'Critical',
            check: async () => {
                const auditReports = await this.getAuditReports();
                return {
                    passed: auditReports.length >= 2 && 
                           auditReports.every(r => r.criticalIssues === 0),
                    message: `${auditReports.length} audits completed`,
                    details: auditReports
                };
            }
        });
        
        // å¤šç­¾é…ç½®æ£€æŸ¥
        this.addCheck({
            name: 'Multisig Configuration',
            category: 'Governance',
            severity: 'Critical',
            check: async () => {
                const multisig = await this.getMultisigConfig();
                return {
                    passed: multisig.threshold >= 3 && 
                           multisig.owners.length >= 5,
                    message: `${multisig.threshold}/${multisig.owners.length} multisig`,
                    details: multisig
                };
            }
        });
        
        // ç›‘æ§é…ç½®æ£€æŸ¥
        this.addCheck({
            name: 'Monitoring Setup',
            category: 'Operations',
            severity: 'High',
            check: async () => {
                const monitors = await this.getMonitoringStatus();
                const required = ['prometheus', 'grafana', 'alertmanager', 'pagerduty'];
                const configured = required.filter(m => monitors[m]?.isActive);
                
                return {
                    passed: configured.length === required.length,
                    message: `${configured.length}/${required.length} monitors active`,
                    details: monitors
                };
            }
        });
        
        // å¤‡ä»½ç­–ç•¥æ£€æŸ¥
        this.addCheck({
            name: 'Backup Strategy',
            category: 'Disaster Recovery',
            severity: 'High',
            check: async () => {
                const backups = await this.getBackupConfig();
                return {
                    passed: backups.frequency <= 86400 && // è‡³å°‘æ¯æ—¥å¤‡ä»½
                           backups.locations.length >= 3 &&
                           backups.lastTestRestore < 7 * 86400, // æœ€è¿‘7å¤©æµ‹è¯•è¿‡
                    message: `Backups to ${backups.locations.length} locations`,
                    details: backups
                };
            }
        });
        
        // æ€§èƒ½åŸºå‡†æ£€æŸ¥
        this.addCheck({
            name: 'Performance Benchmarks',
            category: 'Performance',
            severity: 'Medium',
            check: async () => {
                const benchmarks = await this.runBenchmarks();
                return {
                    passed: benchmarks.tps >= 100 &&
                           benchmarks.latencyP99 < 1000 &&
                           benchmarks.gasEfficiency > 0.8,
                    message: `${benchmarks.tps} TPS, ${benchmarks.latencyP99}ms P99`,
                    details: benchmarks
                };
            }
        });
    }
    
    async runAllChecks(): Promise<ReadinessReport> {
        const results: CheckResult[] = [];
        let criticalPassed = true;
        let highPassed = true;
        
        for (const check of this.checks) {
            console.log(`Running check: ${check.name}...`);
            const result = await check.check();
            results.push({
                ...check,
                result
            });
            
            if (!result.passed) {
                if (check.severity === 'Critical') criticalPassed = false;
                if (check.severity === 'High') highPassed = false;
            }
        }
        
        return {
            timestamp: new Date(),
            overallStatus: criticalPassed && highPassed ? 'READY' : 'NOT_READY',
            results,
            recommendations: this.generateRecommendations(results)
        };
    }
}</code></pre>
                </div>
            </div>
        </div>
        
        <div class="exercise">
            <div class="exercise-header">
                <span class="exercise-icon">ğŸ’»</span>
                <h4>ç»ƒä¹ 12.1ï¼šè®¾è®¡å®Œæ•´çš„ç”Ÿäº§éƒ¨ç½²æµç¨‹</h4>
            </div>
            <p>è®¾è®¡ä¸€ä¸ªç¨³å®šå¸ç³»ç»Ÿçš„å®Œæ•´ç”Ÿäº§éƒ¨ç½²æµç¨‹ï¼ŒåŒ…æ‹¬ï¼š</p>
            <ol>
                <li>å¤šç¯å¢ƒéƒ¨ç½²ç­–ç•¥ï¼ˆå¼€å‘ã€æµ‹è¯•ã€é¢„ç”Ÿäº§ã€ç”Ÿäº§ï¼‰</li>
                <li>è‡ªåŠ¨åŒ–CI/CDæµæ°´çº¿</li>
                <li>è“ç»¿éƒ¨ç½²å®ç°</li>
                <li>å›æ»šæœºåˆ¶</li>
                <li>ç›‘æ§å’Œå‘Šè­¦é›†æˆ</li>
            </ol>
            
            <button class="answer-toggle" onclick="toggleAnswer(this)">æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</button>
            <div class="answer-content">
                <div class="code-block">
                    <div class="code-header" onclick="toggleCode(this)">GitHub Actions CI/CDé…ç½® <span class="toggle-icon">â–¼</span></div>
                    <div class="code-content" style="display: none;">
                        <pre><code class="language-yaml">name: Stablecoin Production Deployment

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

env:
  NODE_VERSION: '18'
  SOLIDITY_VERSION: '0.8.19'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ env.NODE_VERSION }}
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run unit tests
        run: npm run test:unit
        
      - name: Run integration tests
        run: npm run test:integration
        
      - name: Static analysis
        run: |
          npm run lint
          npm run slither
          npm run mythril
          
      - name: Gas optimization check
        run: npm run test:gas
        
  audit:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Run Certik audit
        run: |
          curl -X POST https://api.certik.com/audit \
            -H "Authorization: Bearer ${{ secrets.CERTIK_API_KEY }}" \
            -d '{"project": "stablecoin", "commit": "${{ github.sha }}"}'
            
  deploy-testnet:
    needs: audit
    runs-on: ubuntu-latest
    environment: testnet
    steps:
      - uses: actions/checkout@v3
      
      - name: Deploy to Goerli
        run: |
          npx hardhat deploy --network goerli \
            --tags stablecoin \
            --verify
            
      - name: Run smoke tests
        run: npm run test:smoke -- --network goerli
        
      - name: Update monitoring
        run: |
          curl -X POST ${{ secrets.GRAFANA_WEBHOOK }} \
            -d '{"network": "goerli", "contracts": ${{ steps.deploy.outputs.contracts }}}'
            
  deploy-mainnet:
    needs: deploy-testnet
    runs-on: ubuntu-latest
    environment: mainnet
    if: github.ref_type == 'tag'
    steps:
      - uses: actions/checkout@v3
      
      - name: Verify multisig approval
        run: |
          node scripts/verify-multisig-approval.js \
            --proposal ${{ github.event.inputs.proposal_id }}
            
      - name: Deploy contracts
        run: |
          npx hardhat deploy --network mainnet \
            --tags stablecoin \
            --gasprice auto \
            --verify
            
      - name: Initialize contracts
        run: |
          node scripts/initialize-production.js \
            --network mainnet \
            --contracts ${{ steps.deploy.outputs.contracts }}
            
      - name: Transfer ownership
        run: |
          node scripts/transfer-ownership.js \
            --network mainnet \
            --multisig ${{ secrets.MULTISIG_ADDRESS }}
            
      - name: Update DNS and CDN
        run: |
          # æ›´æ–°å‰ç«¯æŒ‡å‘æ–°åˆçº¦
          aws cloudfront create-invalidation \
            --distribution-id ${{ secrets.CF_DISTRIBUTION_ID }} \
            --paths "/*"
            
      - name: Notify team
        run: |
          curl -X POST ${{ secrets.SLACK_WEBHOOK }} \
            -d '{"text": "Production deployment completed: ${{ github.ref_name }}"}'</code></pre>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="summary-box">
            <h3>æœ¬ç« å°ç»“</h3>
            <p>ç”Ÿäº§éƒ¨ç½²æ˜¯ç¨³å®šå¸é¡¹ç›®æˆåŠŸçš„å…³é”®ç¯èŠ‚ã€‚æœ¬ç« ä»‹ç»äº†ï¼š</p>
            <ul>
                <li><strong>éƒ¨ç½²æ¶æ„</strong>ï¼šå¤šé“¾ç­–ç•¥ã€é«˜å¯ç”¨è®¾è®¡ã€åŸºç¡€è®¾æ–½å³ä»£ç </li>
                <li><strong>ç›‘æ§ä½“ç³»</strong>ï¼šå…¨æ–¹ä½æŒ‡æ ‡ã€æ™ºèƒ½å‘Šè­¦ã€å¯è§†åŒ–ä»ªè¡¨æ¿</li>
                <li><strong>å‡çº§ç­–ç•¥</strong>ï¼šé›¶åœæœºå‡çº§ã€æ•°æ®è¿ç§»ã€ç‰ˆæœ¬ç®¡ç†</li>
                <li><strong>åˆè§„è¦æ±‚</strong>ï¼šKYC/AMLé›†æˆã€å®¡è®¡æ—¥å¿—ã€ç›‘ç®¡æŠ¥å‘Š</li>
                <li><strong>æœ€ä½³å®è·µ</strong>ï¼šä»USDCã€MakerDAOç­‰é¡¹ç›®å­¦ä¹ ç»éªŒ</li>
            </ul>
            
            <p>è®°ä½ï¼šç”Ÿäº§ç¯å¢ƒå®¹ä¸å¾—ä»»ä½•é”™è¯¯ã€‚å……åˆ†çš„å‡†å¤‡ã€ä¸¥æ ¼çš„æµç¨‹ã€å®Œå–„çš„ç›‘æ§æ˜¯ä¿éšœç³»ç»Ÿç¨³å®šè¿è¡Œçš„åŸºç¡€ã€‚æŒç»­æ”¹è¿›å’Œå¿«é€Ÿå“åº”èƒ½åŠ›åŒæ ·é‡è¦ã€‚</p>
        </div>
    
            
            <!-- ç« èŠ‚å¯¼èˆª -->
            <div class="chapter-nav">
                <a href="chapter11.html">â† ç¬¬11ç« </a>
                <a href="chapter13.html">ç¬¬13ç«  â†’</a>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-solidity.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="script.js"></script>
</body>
</html>